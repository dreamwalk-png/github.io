<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Game Genre Map — Interactive Encyclopedia</title>
<meta name="description" content="Interactive one-page map of game genres, subgenres and representative game titles." />
<style>
  :root{
    --bg:#0b0b0c;
    --panel:#0f1720;
    --muted:#98a0aa;
    --accent:#6be6c1;
    --glass: rgba(255,255,255,0.03);
    --bubble-size: 120px;
    --main-bubble-size: 120px;
    --sub-bubble-size: 72px;
    --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:radial-gradient(ellipse at 20% 10%, rgba(107,230,193,0.03), transparent 10%), var(--bg); color:#e6eef3; font-family:var(--font-sans); -webkit-font-smoothing:antialiased;}
  .app{
    height:100vh;
    display:flex;
    position:relative;
    overflow:hidden;
  }

  /* Canvas area */
  .map {
    flex:1;
    position:relative;
    min-width:0;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  /* svg overlay for lines */
  svg.lines {
    position:absolute;
    inset:0;
    pointer-events:none;
  }

  /* central hub style */
  .hub {
    position:relative;
    width:min(1200px, 92%);
    height:min(800px, 86vh);
    max-width:1600px;
    border-radius:16px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    box-shadow: 0 8px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    overflow:hidden;
  }

  /* bubbles container is positioned absolute inside hub */
  .bubbles {
    position:absolute;
    inset:0;
    pointer-events:auto;
  }

  .bubble {
    position:absolute;
    transform:translate(-50%,-50%);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    cursor:pointer;
    user-select:none;
    transition:transform .28s cubic-bezier(.2,.9,.3,1), box-shadow .25s;
    will-change:transform;
    border-radius:999px;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    padding:12px;
    color: #eef6f1;
    font-weight:600;
  }
  .bubble:focus{outline:none; box-shadow: 0 10px 30px rgba(0,0,0,0.7), 0 0 0 4px rgba(107,230,193,0.12);}
  .main {
    width:var(--main-bubble-size);
    height:var(--main-bubble-size);
    font-size:14px;
    letter-spacing:0.2px;
  }
  .sub {
    width:var(--sub-bubble-size);
    height:var(--sub-bubble-size);
    font-size:12px;
    font-weight:600;
    opacity:0.98;
  }
  .game-node {
    background:var(--glass);
    padding:6px 8px;
    border-radius:12px;
    font-weight:500;
    font-size:12px;
    color:var(--muted);
    width:max-content;
    max-width:140px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  /* clicked / active */
  .bubble.active{ transform: translate(-50%,-50%) scale(1.08); box-shadow: 0 18px 40px rgba(0,0,0,0.75); }
  .bubble.fade-out { opacity:0.24; transform: scale(.92); }

  /* header */
  .topbar {
    position:absolute;
    left:22px;
    top:14px;
    display:flex;
    align-items:center;
    gap:12px;
    z-index:30;
  }
  .brand {
    display:flex;
    gap:10px;
    align-items:center;
    color:var(--accent);
    font-weight:700;
    letter-spacing:0.6px;
    font-size:18px;
    text-transform:uppercase;
  }
  .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 6px 18px rgba(107,230,193,0.12);}

  /* side panel */
  .panel {
    width:360px;
    max-width:92vw;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-left:1px solid rgba(255,255,255,0.03);
    position:relative;
    z-index:60;
    padding:22px;
    box-shadow: -10px 0 40px rgba(0,0,0,0.7);
    transform:translateX(100%);
    transition:transform .32s cubic-bezier(.2,.9,.3,1);
    display:flex;
    flex-direction:column;
    gap:12px;
    color:#cfe8e0;
  }
  .panel.open{ transform:translateX(0); }
  .panel h2{ margin:0; font-size:20px; }
  .panel .meta{ color:var(--muted); font-size:13px; margin-top:6px; }
  .panel p{ margin:0; color:#d7eef0; line-height:1.45;}
  .panel .close {
    margin-left:auto;
    background:transparent;
    border:0;
    color:var(--muted);
    font-size:18px;
    cursor:pointer;
  }
  .panel .games-list{
    margin-top:8px;
    display:flex;
    flex-direction:column;
    gap:8px;
    max-height:42vh;
    overflow:auto;
    padding-right:6px;
  }
  .games-list button{
    background:transparent;
    border:1px solid rgba(255,255,255,0.04);
    padding:8px 10px;
    border-radius:10px;
    color:#e6f7ef;
    text-align:left;
    cursor:pointer;
  }

  /* info footer small */
  .hint {
    position:absolute;
    right:18px;
    bottom:12px;
    color:var(--muted);
    font-size:13px;
    z-index:20;
    backdrop-filter: blur(6px);
    padding:8px 10px;
    border-radius:10px;
    background:rgba(255,255,255,0.01);
    border:1px solid rgba(255,255,255,0.02);
  }

  /* small screens */
  @media (max-width:800px){
    .panel{ position:fixed; right:0; top:0; bottom:0; width:86vw; padding:18px; }
    .hub{ height:100vh; border-radius:0; }
    .topbar{ left:12px; top:8px; }
  }

  /* interactive pointer small hover */
  .bubble:hover{ transform: translate(-50%,-50%) scale(1.06); }

  /* subtle radial grid */
  .grid-overlay{
    position:absolute;
    inset:0;
    pointer-events:none;
    background-image:
      radial-gradient(circle at center, rgba(255,255,255,0.01) 1px, transparent 1px);
    background-size: 120px 120px;
    opacity:0.08;
    mix-blend-mode:screen;
  }
</style>
</head>
<body>
<div class="app" role="application" aria-label="Game genre map">
  <div class="map">
    <div class="hub" id="hub" aria-hidden="false">
      <div class="topbar">
        <div class="brand" title="GameMap">
          <span class="dot" aria-hidden="true"></span>
          GameMap
        </div>
      </div>

      <svg class="lines" id="svg-lines" aria-hidden="true"></svg>

      <div class="bubbles" id="bubbles" tabindex="0" aria-label="Genre bubbles container"></div>

      <div class="grid-overlay" aria-hidden="true"></div>

      <div class="hint" aria-hidden="false">Click a genre bubble to expand subgenres & games — tap again to close</div>
    </div>
  </div>

  <aside class="panel" id="panel" aria-hidden="true" aria-labelledby="panel-title">
    <div style="display:flex;align-items:center;gap:12px;">
      <div>
        <h2 id="panel-title">Welcome</h2>
        <div class="meta" id="panel-meta">Interactive encyclopedia of game genres</div>
      </div>
      <button class="close" id="panel-close" aria-label="Close side panel">✕</button>
    </div>
    <p id="panel-desc">Click any main genre or subgenre bubble to see a short description and sample games. This panel is editable in the page's script if you want different text.</p>
    <div style="font-size:13px;color:var(--muted);margin-top:8px;">Notable titles</div>
    <div class="games-list" id="panel-games" role="list"></div>
  </aside>
</div>

<script>
/*
  Single-file interactive Game Genre Map
  - Edit the data below to add/remove genres, subgenres, games and descriptions.
  - The script handles drawing bubbles, connecting lines, the side panel contents, and interactions.
*/

/* ---------- DATA: modify this to control content ---------- */
const GENRE_DATA = [
  {
    id: 'rpg',
    name: 'RPG',
    desc: 'Role-playing games emphasize character progression, narrative, and player choices. Subgenres vary from action-oriented to party-based tactics and online persistent worlds.',
    subgenres: [
      { id:'mmorpg', name:'MMORPG', desc:'Massively multiplayer RPGs with persistent worlds and social systems.', games:['World of Warcraft','Final Fantasy XIV','Guild Wars 2'] },
      { id:'arpg', name:'Action RPG', desc:'Real-time combat and loot-driven progression.', games:['Diablo II/III','Path of Exile','Torchlight'] },
      { id:'jrpg', name:'JRPG', desc:'Narrative-driven RPGs often with turn-based combat and character ensembles.', games:['Chrono Trigger','Final Fantasy VII','Persona 5'] },
      { id:'roguelike', name:'Roguelike / Roguelite', desc:'Procedural generation + permadeath (often with meta-progression).', games:['Hades','Dead Cells','Rogue Legacy'] },
      { id:'soulslike', name:'Soulslike', desc:'High-difficulty, methodical combat with interconnected worlds and checkpoint systems.', games:['Dark Souls','Sekiro','Nioh'] }
    ],
    games: ['Skyrim','Baldur\'s Gate 3','The Witcher 3']
  },
  {
    id: 'shooter',
    name: 'Shooter',
    desc: 'Games centered on ranged combat. Focus ranges from fast arena FPS to tactical military simulators to last-man-standing battle royales.',
    subgenres: [
      { id:'fps', name:'First-Person Shooter (FPS)', desc:'Player sees through character eyes, emphasis on reflexes and aiming.', games:['Doom','Quake','Call of Duty'] },
      { id:'tps', name:'Third-Person Shooter (TPS)', desc:'Camera outside the player; often combined with cover mechanics.', games:['Gears of War','The Division','Max Payne'] },
      { id:'br', name:'Battle Royale', desc:'Large player counts fight until one remains; often includes looting and shrinking zones.', games:['Fortnite','PUBG','Apex Legends'] },
      { id:'hero', name:'Hero Shooter', desc:'Objective-focused shooters with distinct heroes/abilities.', games:['Overwatch','Team Fortress 2','Valorant'] }
    ],
    games: ['Half-Life','BioShock']
  },
  {
    id: 'strategy',
    name: 'Strategy',
    desc: 'Emphasis on planning, economy, and tactical/strategic decisions. Play ranges from real-time to turn-based.',
    subgenres: [
      { id:'rts', name:'RTS', desc:'Real-time strategy with base-building and unit control.', games:['StarCraft II','Age of Empires II','Command & Conquer'] },
      { id:'tbs', name:'TBS', name_alt:'Turn-based strategy', desc:'Turn-based play, often more methodical and party-based.', games:['XCOM 2','Civilization VI','Heroes of Might & Magic III'] },
      { id:'4x', name:'4X', desc:'Explore, Expand, Exploit, Exterminate — grand strategy and empire-building.', games:['Civilization VI','Endless Space 2'] },
      { id:'moba', name:'MOBA', desc:'Team-based lanes, character progression within a match.', games:['League of Legends','Dota 2','Smite'] }
    ],
    games: ['Total War: Warhammer','Crusader Kings III']
  },
  {
    id: 'adventure',
    name: 'Adventure',
    desc: 'Player-driven exploration and narrative, puzzles and environmental storytelling are common.',
    subgenres: [
      { id:'pointclick', name:'Point & Click', desc:'Puzzle- and dialogue-driven adventures with inventory mechanics.', games:['Monkey Island','Broken Sword'] },
      { id:'walking', name:'Walking Sim', desc:'Exploration-heavy narrative experiences with minimal mechanics.', games:['Firewatch','Gone Home'] },
      { id:'survival', name:'Survival', desc:'Resource management and environmental threats.', games:['Subnautica','The Long Dark'] }
    ],
    games: ['Tomb Raider','The Walking Dead']
  },
  {
    id: 'platformer',
    name: 'Platformer',
    desc: 'Games with jumping/precision movement; range from classic 2D to 3D platformers.',
    subgenres: [
      { id:'metroidvania', name:'Metroidvania', desc:'Exploration-focused platformers with ability-based progression.', games:['Hollow Knight','Ori and the Blind Forest','Castlevania: Symphony of the Night'] },
      { id:'2d', name:'2D Platformer', desc:'Classic side-scrolling action and precision.', games:['Celeste','Super Meat Boy'] },
      { id:'3d', name:'3D Platformer', desc:'Larger environments and more open movement.', games:['Super Mario 64','Crash Bandicoot'] }
    ],
    games: ['Mega Man','Rayman']
  },
  {
    id: 'fighting',
    name: 'Fighting',
    desc: 'One-on-one or team combat with combos, frames, and inputs. Focus on skill and matchup knowledge.',
    subgenres: [
      { id:'2d-fighter', name:'2D Fighting', desc:'Traditional arena fighters with 2D plane combat.', games:['Street Fighter','Mortal Kombat','Guilty Gear'] },
      { id:'3d-fighter', name:'3D Fighting', desc:'Combat with full 3D movement and arenas.', games:['Tekken','Virtua Fighter'] }
    ],
    games: ['Super Smash Bros. Ultimate','King of Fighters']
  },
  {
    id: 'sim',
    name: 'Simulation',
    name_alt: 'Sim',
    desc: 'Games that simulate real-world activities or systems, from flight to social sims.',
    subgenres: [
      { id:'flight', name:'Flight Sim', desc:'Realistic aircraft and flight systems.', games:['Microsoft Flight Simulator','X-Plane'] },
      { id:'life', name:'Life Sim', desc:'Social systems, routines, and emergent stories.', games:['The Sims','Stardew Valley'] },
      { id:'racing', name:'Racing', desc:'Vehicle control and competition.', games:['Forza Horizon','Gran Turismo'] }
    ],
    games: ['Kerbal Space Program','Euro Truck Simulator 2']
  },
  {
    id: 'puzzle',
    name: 'Puzzle',
    desc: 'Problem-solving and logic-based challenges, often with high design variety.',
    subgenres: [
      { id:'match3', name:'Match-3 / Casual', desc:'Tile-matching mechanics and progression.', games:['Candy Crush Saga','Bejeweled'] },
      { id:'physics', name:'Physics Puzzle', desc:'Use physics interactions to solve puzzles.', games:['Portal','World of Goo'] }
    ],
    games: ['Tetris','Baba Is You']
  },
  {
    id: 'horror',
    name: 'Horror',
    desc: 'Designed to evoke fear, tension and dread. Mechanics can include limited resources, stealth, and psychological effects.',
    subgenres: [
      { id:'survival-horror', name:'Survival Horror', desc:'Limited resources + survival tension.', games:['Resident Evil','Silent Hill'] },
      { id:'psychological', name:'Psychological Horror', desc:'Atmosphere and narrative-driven scares.', games:['Amnesia','Layers of Fear'] }
    ],
    games: ['Outlast','Alien: Isolation']
  },
  {
    id: 'sports',
    name: 'Sports',
    desc: 'Simulations or arcade representations of real-world sports and competitive activities.',
    subgenres: [
      { id:'football', name:'Team Sports', desc:'Football, basketball and other team-based sports sims.', games:['FIFA','NBA 2K'] },
      { id:'extreme', name:'Extreme / Racing Sports', desc:'Skateboarding, snowboarding and extreme competitions.', games:['Tony Hawk Pro Skater','SSX'] }
    ],
    games: ['Madden NFL','F1 2021']
  }
];

/* ---------- end DATA ---------- */

/* Utility helpers */
function el(tag, attrs={}, children=[]){
  const d = document.createElement(tag);
  for(const k in attrs){
    if(k==='class') d.className = attrs[k];
    else if(k==='html') d.innerHTML = attrs[k];
    else d.setAttribute(k, attrs[k]);
  }
  (Array.isArray(children)?children:[children]).forEach(c=>{ if(!c) return; if(typeof c === 'string') d.appendChild(document.createTextNode(c)); else d.appendChild(c);});
  return d;
}

/* Main rendering & interactions */
const hub = document.getElementById('hub');
const bubblesContainer = document.getElementById('bubbles');
const svg = document.getElementById('svg-lines');
const panel = document.getElementById('panel');
const panelTitle = document.getElementById('panel-title');
const panelMeta = document.getElementById('panel-meta');
const panelDesc = document.getElementById('panel-desc');
const panelGames = document.getElementById('panel-games');
const panelClose = document.getElementById('panel-close');

let activeMainId = null;
let activeSubId = null;
let nodes = {}; // store node elements and positions

// viewport size for hub
function hubRect(){ return hub.getBoundingClientRect(); }

/* place main genre bubbles arranged in a ring */
function layoutMainBubbles(){
  bubblesContainer.innerHTML = '';
  svg.innerHTML = '';
  nodes = {};
  const center = { x: hubRect().width/2, y: hubRect().height/2 + 10 }; // tiny vertical offset
  const radius = Math.min(hubRect().width, hubRect().height) * 0.33;
  const count = GENRE_DATA.length;
  for(let i=0;i<count;i++){
    const g = GENRE_DATA[i];
    const angle = (i / count) * Math.PI * 2 - Math.PI/2; // start at top
    const x = center.x + Math.cos(angle)*radius;
    const y = center.y + Math.sin(angle)*radius * 0.95;
    const node = el('button', { class:'bubble main', 'data-id':g.id, 'aria-label': g.name, tabindex:0 });
    node.innerHTML = `<div style="padding:6px">${g.name}</div>`;
    node.style.left = x + 'px';
    node.style.top = y + 'px';
    bubblesContainer.appendChild(node);

    nodes[g.id] = { x, y, el: node, data: g };

    node.addEventListener('click', ()=> onMainClick(g.id));
    node.addEventListener('keydown', (ev)=> { if(ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); onMainClick(g.id); }});
  }
}

/* draw a line in the svg from a to b (objects with x,y) */
function drawLine(a,b,opts={}){
  const line = document.createElementNS("http://www.w3.org/2000/svg","path");
  const dx = b.x - a.x;
  const dy = b.y - a.y;
  const mx = a.x + dx*0.45;
  const my = a.y + dy*0.45;
  // smooth cubic
  const d = `M ${a.x} ${a.y} C ${mx} ${a.y}, ${mx} ${b.y}, ${b.x} ${b.y}`;
  line.setAttribute('d', d);
  line.setAttribute('stroke', opts.stroke || 'rgba(107,230,193,0.18)');
  line.setAttribute('stroke-width', opts.width || 1.25);
  line.setAttribute('fill','none');
  line.setAttribute('stroke-linecap','round');
  line.setAttribute('opacity', opts.opacity || 0.85);
  svg.appendChild(line);
  return line;
}

/* When main genre clicked: show subgenres & game nodes, update panel */
function onMainClick(id){
  const clicked = nodes[id];
  if(!clicked) return;
  // if clicking the same active -> toggle close
  if(activeMainId === id){
    closeSubgenres();
    return;
  }
  activeMainId = id;
  activeSubId = null;
  // mark actives
  for(const k in nodes){
    nodes[k].el.classList.toggle('active', k===id);
    nodes[k].el.classList.toggle('fade-out', k!==id);
  }
  // clear svg and old subs/games
  svg.innerHTML = '';
  removeSubsAndGames();
  // draw sub-bubbles around clicked main bubble
  renderSubgenres(clicked);
  // draw game nodes around the main bubble
  renderGameNodes(clicked);
  // open panel with the main genre description
  openPanelFor(clicked.data);
}

/* remove sub & game nodes (but keep main bubbles) */
function removeSubsAndGames(){
  const toRemove = [...bubblesContainer.querySelectorAll('.sub, .game-node')];
  toRemove.forEach(n=> n.remove());
}

/* close active subgenres */
function closeSubgenres(){
  activeMainId = null;
  activeSubId = null;
  for(const k in nodes){
    nodes[k].el.classList.remove('active','fade-out');
  }
  svg.innerHTML = '';
  removeSubsAndGames();
  closePanel();
}

/* place subgenre bubbles radially around the main bubble */
function renderSubgenres(mainNode){
  const sublist = mainNode.data.subgenres || [];
  if(!sublist.length) return;
  const angleStart = -Math.PI/2;
  const spread = Math.PI * 1.6; // wide fan
  const center = { x: mainNode.x, y: mainNode.y };
  const radius = 140 + Math.min(hubRect().width, hubRect().height)*0.04;
  // For each subgenre, compute position in fan away from hub center
  const baseIndex = GENRE_DATA.findIndex(g=>g.id === mainNode.data.id);
  const mainAngle = (baseIndex / GENRE_DATA.length) * Math.PI * 2 - Math.PI/2;
  const fanCenterAngle = mainAngle; // center the fan in the direction of the main bubble
  const count = sublist.length;
  for(let i=0;i<count;i++){
    const frac = (count===1) ? 0.5 : (i/(count-1));
    const angle = fanCenterAngle - spread/2 + frac*spread;
    const x = center.x + Math.cos(angle)*radius;
    const y = center.y + Math.sin(angle)*radius;
    const node = el('button',{ class:'bubble sub', 'data-id': mainNode.data.id + '::' + sublist[i].id, 'aria-label': sublist[i].name, tabindex:0 });
    node.innerHTML = `<div style="padding:6px">${sublist[i].name}</div>`;
    node.style.left = x + 'px';
    node.style.top = y + 'px';
    bubblesContainer.appendChild(node);

    // draw connection line
    drawLine({x:center.x, y:center.y}, {x,y}, {stroke:'rgba(107,230,193,0.12)', width:1.2});

    node.addEventListener('click', ()=> onSubClick(mainNode.data, sublist[i]));
    node.addEventListener('keydown', (ev)=> { if(ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); onSubClick(mainNode.data, sublist[i]); }});
  }
}

/* place game names around main bubble in a looser ring */
function renderGameNodes(mainNode){
  const games = (mainNode.data.games || []).slice(0,10);
  const center = { x: mainNode.x, y: mainNode.y };
  const baseRadius = 230;
  const count = games.length;
  if(count===0) return;
  for(let i=0;i<count;i++){
    const angle = (i/count) * Math.PI*2 - Math.PI/2 + 0.18 * Math.sin(i);
    const x = center.x + Math.cos(angle)*(baseRadius + 30 * Math.sin(i*0.7));
    const y = center.y + Math.sin(angle)*(baseRadius + 10 * Math.cos(i*0.6));
    const node = el('button', { class:'game-node', 'data-game': games[i], tabindex:0, title: games[i]});
    node.textContent = games[i];
    node.style.position = 'absolute';
    node.style.left = x + 'px';
    node.style.top = y + 'px';
    bubblesContainer.appendChild(node);

    drawLine(center, {x,y}, {stroke:'rgba(255,255,255,0.03)', width:0.9, opacity:0.6});

    node.addEventListener('click', ()=> {
      // open panel with game highlighted
      openPanelFor(mainNode.data, {title: games[i], extra: `Representative title for ${mainNode.data.name}`});
    });
    node.addEventListener('keydown', (ev)=> { if(ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); openPanelFor(mainNode.data, {title: games[i], extra: `Representative title for ${mainNode.data.name}`}); }});
  }
}

/* When a subgenre clicked, update panel and maybe show sub-specific game nodes */
function onSubClick(mainGenreData, subData){
  activeSubId = subData.id;
  // highlight the clicked sub bubble visually
  // make all sub bubbles slightly faded except clicked
  const subs = bubblesContainer.querySelectorAll('.sub');
  subs.forEach(s => s.classList.toggle('fade-out', s.getAttribute('data-id') !== mainGenreData.id + '::' + subData.id));
  // clear game nodes (we will render sub-specific games near the sub bubble)
  const toRemove = [...bubblesContainer.querySelectorAll('.game-node')];
  toRemove.forEach(n=> n.remove());
  svg.innerHTML = '';
  // draw line from main to sub (re-draw main -> sub lines)
  // find main node position:
  const mainNode = nodes[mainGenreData.id];
  // render sub-focused game nodes around the sub bubble
  // find sub bubble element:
  const subEl = bubblesContainer.querySelector(`[data-id="${mainGenreData.id}::${subData.id}"]`);
  if(!subEl) return;
  const rect = subEl.getBoundingClientRect();
  // compute center relative to hub
  const hubRectOb = hub.getBoundingClientRect();
  const subCenter = {
    x: rect.left - hubRectOb.left + rect.width/2,
    y: rect.top - hubRectOb.top + rect.height/2
  };
  // draw connection main->sub
  drawLine({x: mainNode.x, y: mainNode.y}, subCenter, {stroke:'rgba(107,230,193,0.18)', width:1.4});
  // add game nodes around sub
  const games = subData.games || [];
  const baseRadius = 120;
  for(let i=0;i<games.length;i++){
    const angle = (i/(games.length||1)) * Math.PI*2 - Math.PI/2;
    const x = subCenter.x + Math.cos(angle)*(baseRadius + (i%2?8:-8));
    const y = subCenter.y + Math.sin(angle)*(baseRadius + (i%2?6:-6));
    const node = el('button', { class:'game-node', 'data-game': games[i], tabindex:0, title: games[i]});
    node.textContent = games[i];
    node.style.position = 'absolute';
    node.style.left = x + 'px';
    node.style.top = y + 'px';
    bubblesContainer.appendChild(node);
    drawLine(subCenter,{x,y},{stroke:'rgba(255,255,255,0.02)', width:0.9, opacity:0.6});
    node.addEventListener('click', ()=> {
      openPanelFor(mainGenreData, {title: games[i], extra: `Representative for ${subData.name}`});
    });
    node.addEventListener('keydown', (ev)=> { if(ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); openPanelFor(mainGenreData, {title: games[i], extra: `Representative for ${subData.name}`}); }});
  }
  // open panel with subgenre description
  openPanelFor(mainGenreData, { sub: subData });
}

/* open the side panel and fill content */
function openPanelFor(mainData, opts = {}){
  panel.classList.add('open');
  panel.setAttribute('aria-hidden','false');
  // Title: if opts.title (game) show that, else show sub or main
  if(opts.title){
    panelTitle.textContent = opts.title;
    panelMeta.textContent = `${mainData.name} — sample title`;
    panelDesc.textContent = opts.extra || `A notable title associated with ${mainData.name}. You can edit details in the page data.`;
    panelGames.innerHTML = '';
    const backBtn = el('button', { style:'margin-bottom:6px;background:transparent;border:0;color:var(--accent);cursor:pointer;' }, 'Back to genre');
    backBtn.addEventListener('click', ()=> openPanelFor(mainData));
    panelGames.appendChild(backBtn);
    return;
  }
  if(opts.sub){
    panelTitle.textContent = opts.sub.name;
    panelMeta.textContent = `${mainData.name} — ${opts.sub.name}`;
    panelDesc.textContent = opts.sub.desc || mainData.desc || 'No description available.';
    panelGames.innerHTML = '';
    (opts.sub.games || []).forEach(g => {
      const b = el('button', {}, g);
      b.addEventListener('click', ()=> {
        panelTitle.textContent = g;
        panelMeta.textContent = `${opts.sub.name} — title`;
        panelDesc.textContent = `Representative title: ${g}. (Edit content in the data object in the HTML.)`;
      });
      panelGames.appendChild(b);
    });
    return;
  }
  // Default: show main genre
  panelTitle.textContent = mainData.name;
  panelMeta.textContent = 'Main genre';
  panelDesc.textContent = mainData.desc || 'Description not set.';
  panelGames.innerHTML = '';
  (mainData.games || []).slice(0,12).forEach(g => {
    const b = el('button', {}, g);
    b.addEventListener('click', ()=> {
      openPanelFor(mainData, { title: g, extra: `Representative title for ${mainData.name}`});
    });
    panelGames.appendChild(b);
  });
}

/* close panel */
function closePanel(){
  panel.classList.remove('open');
  panel.setAttribute('aria-hidden','true');
  panelTitle.textContent = 'Welcome';
  panelMeta.textContent = 'Interactive encyclopedia of game genres';
  panelDesc.textContent = 'Click any main genre or subgenre bubble to see a short description and sample games.';
  panelGames.innerHTML = '';
}

panelClose.addEventListener('click', ()=> closePanel());

/* close when clicking background outside bubbles or pressing Escape */
document.addEventListener('click', (ev)=>{
  const isBubble = ev.target.closest('.bubble, .game-node, .panel, .topbar');
  if(!isBubble){
    // if clicked outside, close expanded elements
    closeSubgenres();
  }
});
document.addEventListener('keydown', (ev)=>{
  if(ev.key === 'Escape'){
    closeSubgenres();
  }
});

/* keep layout updated on resize */
let resizeTimer;
window.addEventListener('resize', ()=> {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=> {
    layoutMainBubbles();
  }, 120);
});

/* initial render */
layoutMainBubbles();

/* a few helpful accessible instructions for screen readers */
const srHint = el('div',{style:'position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;'}, 'GameMap: Use tab/arrow keys to navigate bubbles. Press Enter or Space to expand.');
document.body.appendChild(srHint);

/* Developers: how to customize
   - Edit the GENRE_DATA array at the top of the file.
   - Each main genre object: {id, name, desc, subgenres:[{id,name,desc,games:[] }], games:[]}
   - To add more game nodes that appear around a subgenre, add to its games array.
*/

</script>
</body>
</html>
